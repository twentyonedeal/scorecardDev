<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>Js ScoreCard V108</title>
    <link rel="manifest" href="manifest.json">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
	<meta name="apple-mobile-web-app-title" content="Scorecard">
	<link rel="apple-touch-icon" href="apple-touch-icon.png">
		

   <style>
	
        * { box-sizing: border-box; }
        :root { --hideNum: "white"; --bg: #f0f2f5; --card: #ffffff; --text: #2c3e50; --border: #ced4da; --accent: #27ae60; --total-bg: #e2e6ea; }
        .dark-mode { --bg: #121212; --card: #1e1e1e; --text: #e0e0e0; --border: #444; --accent: #2ecc71; --total-bg: #2d2d2d; }
               
        body { font-family: -apple-system, sans-serif; background: var(--bg); color: var(--text); padding: 10px; margin: 0; -webkit-tap-highlight-color: transparent; }
        .container { background: var(--card); padding: 12px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.2); max-width: 500px; margin: auto; }
         
		.hide-column .toggle-col {
			display: none;
			}	 
			  
        button, .circle-color-picker, .square-color-picker, b, .score-cell, 
        .del-round-btn, .trash-btn, td[onclick], span[onclick] { cursor: pointer; }

        .header-area { display: flex; justify-content: center; align-items: center; gap: 10px; margin-bottom: 5px; }
        #offlineTag { font-size: 0.6rem; padding: 2px 6px; border-radius: 4px; font-weight: bold; text-transform: uppercase; }
        .online { background: #27ae60; color: white; }
        .offline { background: #e67e22; color: white; }
        .modal-content { background: var(--card); padding: 20px; border-radius: 15px; width: 90%; max-width: 400px; text-align: center; max-height: 85vh; overflow-y: auto; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 1000; justify-content: center; align-items: center; padding: 15px; }

        #confirmModal { z-index: 2001; } 
        
		#leaderboardTable { width: 100%; border-collapse: collapse; table-layout: fixed; margin-bottom: 20px; }
        #leaderboardTable td { padding: 0; border-bottom: 1px solid var(--border); vertical-align: middle; height: 52px; }


        .win-toggle-container { display: flex; align-items: center; justify-content: center; background: var(--bg); padding: 8px; border-radius: 10px; margin-bottom: 10px; gap: 10px; font-size: 0.85rem; font-weight: bold; }
        .switch { position: relative; display: inline-block; width: 40px; height: 20px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { cursor: pointer; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background-color: #42f5c5; transition: .4s; border-radius: 20px; }
        .slider:before { position: absolute; content: ""; height: 14px; width: 14px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #f39c12; }
        input:checked + .slider:before { transform: translateX(20px); }

        .calc-display { background: #000; color: #0f0; padding: 15px; font-family: monospace; font-size: 24px; text-align: right; border-radius: 8px; margin-bottom: 10px; }
        .calc-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
        .calc-btn { padding: 15px 0; background: #34495e; color: white; border-radius: 8px; border: none; font-weight: bold; font-size: 1.1rem; }
        .calc-btn.op { background: #f39c12; }
        .col-batch { width: 95px; text-align: right; padding-right: 8px !important; position: relative;text-transform: uppercase; font-size: 1.8rem; letter-spacing: .05px; }

		.calc-trigger { position: absolute; right: 12px; top: 50%; transform: translateY(-50%); font-size: 12px; background: #34495e; color: white; padding: 4px 6px; border-radius: 4px; opacity: 0.8; }

        #roundTable { width: 100%; border-collapse: collapse; text-align: center; font-size: 0.9rem; }
        #roundTable th, #roundTable td { padding: 8px 4px; border: 1px solid var(--border); }
        .score-cell { font-weight: bold; color: #f5b342; display: inline-block; border: none; background: transparent; }
        .badge { background: #52442d; color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.7rem; }
        .section-title { display: flex; justify-content: space-between; align-items: center; margin: 20px 0 10px 0; padding-bottom: 5px; border-bottom: 2px solid var(--border); font-weight: 800; text-transform: uppercase; font-size: 0.85rem; letter-spacing: 1px; color: var(--text); }
        .controls { display: flex; justify-content: space-between; align-items: center; margin: 0px 0 10px 0; padding-bottom: 5px; font-weight: 800; text-transform: uppercase; font-size: 0.65rem; letter-spacing: 1px; color: #95a5a6; }

		input, select, textarea {
    		font-size: 16px !important;
			}
        input[type="number"], input[type="text"] { padding: 10px; border: 1px solid var(--border); border-radius: 8px; background: var(--card); color: var(--text); }
        #toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: #333; color: white; padding: 12px 25px; border-radius: 25px; font-size: 0.9rem; opacity: 0; transition: opacity 0.3s; z-index: 4000; pointer-events: none; }


		
    </style>
</head>
<body>
<div class="container">
    <h1 style="text-align:center; font-size: 1.5rem; margin:0 0 5px 0;">Jay's Ultimate Scorecard</h1>
    <div style="text-align:center;  font-size: .75rem; margin:0 0 5px 0;">v109A</div>
    <div id="activeGameLabel" style="font-size: 0.75rem; text-align: center; margin-bottom:5px;"></div>
            <span style="display: inline-block; margin-bottom:10px;" id="offlineTag">Checking...</span>





    <div style="display:grid; grid-template-columns: 1fr 1fr 44px; gap:8px; margin-bottom:15px;">
        <button onclick="openSaveModal()" style="background:#3498db; color:white; border:none; border-radius:8px; padding:12px;">üíæ Save</button>
        <button onclick="openLibrary()" style="background:#9b59b6; color:white; border:none; border-radius:8px; padding:12px;">üìö Lib</button>
        <button onclick="toggleDarkMode()" style="background:#34495e; color:white; border:none; border-radius:8px; padding:12px;">üåô</button>
    </div>

    <div style="display: flex; gap: 8px; margin-bottom: 20px; background: var(--bg); padding: 8px; border-radius: 10px; align-items: center;">
        <input type="text" id="playerName" placeholder="Player Name" style="flex:1;" onkeydown="if(event.key==='Enter') addPlayer()">
        <div class="square-color-picker" id="colorPreview" style="width:40px; height:40px; border-radius:8px; background:#3498db;" onclick="openColorPicker('new')"></div>
        <button onclick="addPlayer()" style="background:var(--accent); color:white; border:none; padding:10px 15px; border-radius:8px; font-weight:bold;">Add</button>
    </div>
	       <div class="win-toggle-container">
    <span id="highWinsLabel" style="color: #27ae60; font-weight: bold;">High Wins</span>
    <label class="switch">
        <input type="checkbox" id="winConditionToggle" onchange="toggleWinCondition()">
        <span class="slider"></span>
    </label>
    <span id="lowWinsLabel" style="color: grey;">Low Wins</span>
</div>
		<div id="winnerSpotlight" style="text-align:center; padding:10px; border-radius:10px; font-weight:bold; display:none; color: black;"></div>
       <div class="section-title">
	   <span>üèÜ Leader Board</span>
			<div class="controls">
        <label>
            <input type="checkbox" style="cursor: pointer;" id="toggleNumbers" checked onchange="updateVisibility()"> 
            Last Round Scores
        </label>
    </div>
	</div>
   
   <table id="leaderboardTable"><tbody id="leaderboard"></tbody></table>
    <table style="width:100%; border-collapse:collapse;"><tbody id="leaderboard"></tbody></table>


    <div id="batchAction" style="display:none; margin-top:15px;">
        <button onclick="submitBatchRound()" style="width:100%; background:#27ae60; padding:15px; font-size:1.1rem; color:white; border:none; border-radius:10px; font-weight:bold;">‚ûï Submit Scores</button>
    </div>


    <div class="section-title">
        <span>üìä Round History</span>
        <span id="roundCounter" class="badge">0 Rounds</span>
    </div>



    <div style="overflow-x:auto; border:1px solid var(--border); border-radius:8px; margin-top:15px;">

		<table id="roundTable">
            <thead><tr id="roundHeader"></tr></thead>
            <tbody id="roundBody"></tbody>
            <tfoot id="roundFooter"></tfoot>
        </table>
    </div>
 
	
    <button onclick="openModal('resetModal')" style="width:100%; margin-top:25px; background:#95a5a6; color:white; border:none; padding:12px; border-radius:8px;">Reset/Start New</button>
    <div id="syncStatus" style="font-size:10px; text-align:center; margin-top:10px; opacity:0.5;">Checking Offline Sync...</div>

</div>

<div id="calcModal" class="modal"><div class="modal-content">
    <div id="calcDisplay" class="calc-display">0</div>
    <div class="calc-grid">
        <button class="calc-btn" onclick="calcPush('7')">7</button><button class="calc-btn" onclick="calcPush('8')">8</button><button class="calc-btn" onclick="calcPush('9')">9</button><button class="calc-btn op" onclick="calcPush('+')">+</button>
        <button class="calc-btn" onclick="calcPush('4')">4</button><button class="calc-btn" onclick="calcPush('5')">5</button><button class="calc-btn" onclick="calcPush('6')">6</button><button class="calc-btn op" onclick="calcPush('-')">-</button>
        <button class="calc-btn" onclick="calcPush('1')">1</button><button class="calc-btn" onclick="calcPush('2')">2</button><button class="calc-btn" onclick="calcPush('3')">3</button><button class="calc-btn op" onclick="calcClear()">C</button>
        <button class="calc-btn" onclick="calcPush('0')" style="grid-column:span 2">0</button><button class="calc-btn op" onclick="calcSolve()">=</button><button class="calc-btn op" onclick="calcPush('*')">√ó</button>
        <button class="calc-btn" style="grid-column:span 2; background:#95a5a6" onclick="closeModal('calcModal')">Cancel</button>
        <button class="calc-btn" style="grid-column:span 2; background:var(--accent)" onclick="calcApply()">Apply</button>
    </div>
</div></div>


<div id="saveGameModal" class="modal"><div class="modal-content">
<h3>Save Game</h3>
<input type="text" id="saveNameIn" placeholder="LisaWins" onkeydown="if(event.key==='Enter') doSave(false)">
<div style="display:flex; flex-direction:column; gap:8px; margin-top:15px;">
<button onclick="doSave(false)" style="width:100%; background:#27d647; padding:15px .2rem; font-size:1rem; color:black; border:none; border-radius:10px;">Update Current (or Change Name)</button>
<button onclick="doSave(true)" style="width:100%; background:#3498db;  padding:15px .2rem; font-size:1rem; color:black; border:none; border-radius:10px;">Save Copy (or Enter New Name)</button>
<button onclick="closeModal('saveGameModal')" style="width:100%; background:#95a5a6;  padding:15px .2rem; font-size:1rem; color:black; border:none; border-radius:10px;">Cancel</button>
</div>
</div></div>

<div id="confirmModal" class="modal"><div class="modal-content"><h3 id="confirmTitle">Delete?</h3>
<div style="display:flex; gap:10px;"><button id="confirmYes" style="flex:1; background:#e74c3c; color:white; border:none; padding:12px; border-radius:8px;">Yes</button>
<button onclick="closeModal('confirmModal')" style="flex:1; background:#95a5a6; color:white; border:none; padding:12px; border-radius:8px;">No</button></div></div></div>


<div id="resetModal" class="modal"><div class="modal-content">
    <h3>Reset Game</h3>
    <div style="display:flex; flex-direction:column; gap:8px; margin-top:15px;">
	<button onclick="doReset('scores')" style="width:100%; background:#3498db; padding:15px .2rem; font-size:1rem; color:black; border:none; border-radius:10px;">Clear Scores Only</button>
    <button onclick="doReset('all')" style="width:100%; background:#e74c3c; padding:15px .2rem; font-size:1rem; color:black; border:none; border-radius:10px;">Full Reset</button>
    <button onclick="closeModal('resetModal')" style="width:100%; background:#95a5a6; padding:15px .2rem; font-size:1rem; color:black; border:none; border-radius:10px;">Cancel</button>
</div>
</div></div>

<div id="renameModal" class="modal"><div class="modal-content"><h3>Rename</h3><input type="text" id="renameIn" style="width:100%;" onkeydown="if(event.key==='Enter') saveRename()"><button onclick="saveRename()" style="width:100%; margin-top:10px; background:var(--accent); color:white; padding:12px; border:none; border-radius:8px;">Update</button></div></div>
<div id="editModal" class="modal"><div class="modal-content">
<h3>Edit Score</h3>
 <input type="number" pattern="[0-9]*" id="editIn" style="width:100%;
" onkeydown="if(event.key==='Enter') saveEdit()">
<button onclick="saveEdit()" style="width:100%; margin-top:15px; padding:12px; background:var(--accent); color:white; border:none; border-radius:8px;">Update Score</button>
    <button onclick="closeModal('editModal')" style="width:100%; margin-top:15px; padding:12px; background:#95a5a6; color:white; border:none; border-radius:8px;">Cancel</button>
</div></div>


<div id="libraryModal" class="modal"><div class="modal-content" style="max-width:380px;"><h3>üìö Library</h3><div id="libList" style="max-height:350px; overflow-y:auto;"></div><button onclick="closeModal('libraryModal')" style="width:100%; background:#95a5a6;  padding:15px .2rem; font-size:1rem; color:black; border:none; border-radius:10px;">Close</button></div></div>


<div id="colorModal" class="modal"><div class="modal-content"><h3>Pick Color</h3><input type="color" id="nativePicker" oninput="liveColor(this.value)" style="width:100px; height:100px; border:none; background:none;"><button onclick="closeModal('colorModal')" style="width:100%; background:#95a5a6;  padding:15px .2rem; font-size:1rem; color:black; border:none; border-radius:10px;">Done</button></div></div>




<div id="toast"></div>
<script>


	if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('sw.js') // Points to your new file
    .then((registration) => {
        const statusEl = document.getElementById('syncStatus');
        
        // If it's already active
        if (registration.active) {
            statusEl.innerText = "‚úÖ Offline Ready";
        }

        // Listen for the moment it becomes active
        registration.onupdatefound = () => {
            const installingWorker = registration.installing;
            installingWorker.onstatechange = () => {
                if (installingWorker.state === 'activated') {
                    statusEl.innerText = "‚úÖ Offline Ready";
                }
            };
        };
    })
    .catch((err) => {
        document.getElementById('syncStatus').innerText = "‚ö†Ô∏è Offline Unavailable";
        console.error("SW Registration failed:", err);
    });
}


    let players = JSON.parse(localStorage.getItem('v102_p')) || [];
    let rounds = JSON.parse(localStorage.getItem('v102_r')) || [];
    let library = JSON.parse(localStorage.getItem('v102_l')) || [];
    let activeId = localStorage.getItem('v102_aid') || null;
    let isDark = localStorage.getItem('v102_dark') === 'true';
    let lowScoreWins = localStorage.getItem('v102_lowWins') === 'true';
    let hasUnsavedChanges = false, selColor = '#3498db', cTarget = {}, activeCalcId = null, editState = {}, renId = null;

    if (isDark) document.body.classList.add('dark-mode');
    document.getElementById('winConditionToggle').checked = lowScoreWins;

    function updateStatus() {
        const tag = document.getElementById('offlineTag');
        if (navigator.onLine) { tag.innerText = "Online"; tag.className = "online"; }
        else { tag.innerText = "Offline Mode"; tag.className = "offline"; }
    }
    window.addEventListener('online', updateStatus); window.addEventListener('offline', updateStatus); updateStatus();


    function openModal(id) { document.getElementById(id).style.display = 'flex'; }
    function closeModal(id) { document.getElementById(id).style.display = 'none'; }
    function showToast(m) { const t = document.getElementById('toast'); t.innerText = m; t.style.opacity = '1'; setTimeout(() => t.style.opacity = '0', 2000); }
    function toggleDarkMode() { isDark = !isDark; document.body.classList.toggle('dark-mode'); localStorage.setItem('v102_dark', isDark);}
    function toggleWinCondition() { lowScoreWins = document.getElementById('winConditionToggle').checked; localStorage.setItem('v102_lowWins', lowScoreWins);

    const isLowWins = document.getElementById('winConditionToggle').checked;
    const highLabel = document.getElementById('highWinsLabel');
    const lowLabel = document.getElementById('lowWinsLabel');

    if (isLowWins) {
        // Slider is to the RIGHT
        lowLabel.style.color = "#e67e22"; // Orange
        lowLabel.style.fontWeight = "bold";
        
        highLabel.style.color = "grey";
        highLabel.style.fontWeight = "normal";
    } else {
        // Slider is to the LEFT
        highLabel.style.color = "#27ae60"; // Green
        highLabel.style.fontWeight = "bold";
        
        lowLabel.style.color = "grey";
        lowLabel.style.fontWeight = "normal";
    }



	render(); }

    function getRandomColor() {
        const colors = ['#42f5dd', '#e74c3c', '#2ecc71', '#f1c40f', '#9b59b6', '#e67e22', '#f0f70f', '#34495e', '42c8f5'];
        return colors[Math.floor(Math.random() * colors.length)];
    }

    function addPlayer() {
        let n = document.getElementById('playerName'); if(!n.value.trim()) return;
        players.push({ id: Date.now(), name: n.value.trim(), score: 0, color: selColor });
        n.value = ""; 
        selColor = getRandomColor();
        document.getElementById('colorPreview').style.background = selColor;
        hasUnsavedChanges = true; sync();
    }

    function openColorPicker(t, id) { 
        cTarget = {t, id}; 
        let current = (t === 'new') ? selColor : players.find(x => x.id === id).color;
        document.getElementById('nativePicker').value = current;
        openModal('colorModal'); 
    }

    function liveColor(v) { 
        if(cTarget.t === 'new') { 
            selColor = v; document.getElementById('colorPreview').style.background = v; 
        } else { 
            let p = players.find(x => x.id === cTarget.id); p.color = v; 
            hasUnsavedChanges = true; render(); 
        } 
    }

    function openCalc(id) { activeCalcId = id; document.getElementById('calcDisplay').innerText = '0'; openModal('calcModal'); }
    function calcPush(v) { let d = document.getElementById('calcDisplay'); d.innerText = d.innerText === '0' ? v : d.innerText + v; }
    function calcClear() { document.getElementById('calcDisplay').innerText = '0'; }
    function calcSolve() { try { document.getElementById('calcDisplay').innerText = eval(document.getElementById('calcDisplay').innerText.replace(/√ó/g, '*')); } catch { document.getElementById('calcDisplay').innerText = "Error"; } }
    function calcApply() { calcSolve(); let r = document.getElementById('calcDisplay').innerText; if(r !== "Error") { document.getElementById(activeCalcId).value = r; closeModal('calcModal'); } }

    function openRename(id) { renId = id; document.getElementById('renameIn').value = players.find(x => x.id === id).name; openModal('renameModal'); setTimeout(()=>document.getElementById('renameIn').select(), 100); }
    function saveRename() { let p = players.find(x => x.id === renId); p.name = document.getElementById('renameIn').value; hasUnsavedChanges = true; closeModal('renameModal'); render(); }
    
    function askDelP(id) { 
        let p = players.find(x => x.id === id); document.getElementById('confirmTitle').innerText = "Delete " + p.name + "?"; openModal('confirmModal');
        document.getElementById('confirmYes').onclick = () => { players = players.filter(x => x.id !== id); rounds.forEach(r => delete r.scores[id]); hasUnsavedChanges = true; closeModal('confirmModal'); sync(); };
    }

    function submitBatchRound() {
        let nr = { scores: {} }, added = false;
        players.forEach(p => {
            let el = document.getElementById(`b-${p.id}`); let v = parseInt(el.value) || 0;
            p.score += v; nr.scores[p.id] = v; el.value = ""; if(v !== 0) added = true;
        });
        if(added) { rounds.push(nr); hasUnsavedChanges = true; sync(); }
    }

    function openEdit(ri, pi) { editState = {ri, pi}; document.getElementById('editIn').value = rounds[ri].scores[pi]; openModal('editModal'); setTimeout(()=>document.getElementById('editIn').select(), 100); }
    function saveEdit() {
        let nv = parseInt(document.getElementById('editIn').value) || 0;
        let p = players.find(x => x.id === editState.pi);
        p.score = p.score - (rounds[editState.ri].scores[editState.pi] || 0) + nv;
        rounds[editState.ri].scores[editState.pi] = nv;
        hasUnsavedChanges = true; closeModal('editModal'); sync();
    }
    
    function askDelR(ri) { 
        document.getElementById('confirmTitle').innerText = "Delete Round " + (ri+1) + "?"; openModal('confirmModal');
        document.getElementById('confirmYes').onclick = () => { players.forEach(p => p.score -= (rounds[ri].scores[p.id] || 0)); rounds.splice(ri,1); hasUnsavedChanges = true; closeModal('confirmModal'); sync(); };
    }

    function sync() { 
        localStorage.setItem('v102_p', JSON.stringify(players)); 
        localStorage.setItem('v102_r', JSON.stringify(rounds)); 
        localStorage.setItem('v102_aid', activeId);
        render(); 
    }

    function render() {
		
		//let saveMe = "<p style="color: red;">This entire paragraph will be red.</p>;"
        let saveMe = "  (File Save Needed)";
		players.sort((a,b) => lowScoreWins ? a.score - b.score : b.score - a.score);
        let activeGame = library.find(g => g.id == activeId);
document.getElementById('activeGameLabel').innerHTML = activeId 
  ? (hasUnsavedChanges 
      ? `üìÅ: ${activeGame?.name || "LisaWins"} <span style="color: red;">${saveMe}</span>` 
      : `üìÅ: ${activeGame?.name || "LisaWins"}`) 
  : "‚ú® LisaWinsAgain";        document.getElementById('batchAction').style.display = players.length ? 'block' : 'none';
        let lastRound = rounds.length > 0 ? rounds[rounds.length - 1] : null;
        document.getElementById('leaderboard').innerHTML = players.map((p,i) => `
            <tr>
			<td style="width:3px;"><div style="width:3px;height:52px;background:${p.color}"></div></td>
                <td style="width:30px; text-align:center;font-weight:bold;">${i+1}</td>
                <td style="width:35px;"><div class="circle-color-picker" style="background:${p.color}; width:22px; height:22px; border-radius:50%;" onclick="openColorPicker('edit', ${p.id})"></div></td>
                <td><b onclick="openRename(${p.id})">${p.name}</b></td>
                <td onclick="askDelP(${p.id})" style="width:43px; text-align:left; opacity:0.6;">üóëÔ∏è</td>
                <td class="toggle-col" style="text-align:left; font-size:0.7rem; color:var(--hideNum); width:32px;">${lastRound ? `(${lastRound.scores[p.id]})` : ''}</td>
                <td style="text-align:right; font-weight:bold; padding-right:8px; width:60px;">${p.score}</td>
                <td class="col-batch"><input type="number" pattern="[0-9]*" id="b-${p.id}" font-size: 2rem; placeholder="+" style="width:95px; padding:10px; border:2px solid ${p.color}">
				         <button onclick="openCalc('b-${p.id}')" style="position:absolute; right:.4em; top:50%; transform:translateY(-50%); font-size:0.8rem; padding: .3rem .3rem .3rem .3rem; border-radius:4px; border:none; background:#34495e; color:white;">CALC</button>

				</td>
            </tr>`).join('');
			

			
// this section develops the round table
        document.getElementById('roundHeader').innerHTML = `<th>R</th>` + players.map(p => `<th style="background:${p.color}; color:black;">${p.name[0]}</th>`).join('') + `<th>‚úï</th>`;
        document.getElementById('roundBody').innerHTML = rounds.map((r, ri) => `<tr><td>${ri+1}</td>${players.map(p => `<td><span class="score-cell" onclick="openEdit(${ri}, ${p.id})">${r.scores[p.id]||0}</span></td>`).join('')}<td><button class="del-round-btn" onclick="askDelR(${ri})">‚úï</button></td></tr>`).join('');
        document.getElementById('roundFooter').innerHTML = players.length ? `<tr style="background:var(--total-bg); font-weight:bold;"><td>Œ£</td>${players.map(p => `<td style="color:${p.color}">${p.score}</td>`).join('')}<td></td></tr>` : "";
        
		document.getElementById('roundCounter').innerText = `${rounds.length} Rounds Played`;
		if(rounds.length == 1) {document.getElementById('roundCounter').innerText = `${rounds.length} Round Played`;}
		
        const spot = document.getElementById('winnerSpotlight');
        if (players.length) { spot.style.display = 'block'; spot.style.background = players[0].color; spot.innerText = `üèÜ Leader: ${players[0].name}`; } else spot.style.display = 'none';
    }

    function openSaveModal() {
        let activeGame = library.find(g => g.id == activeId);
        document.getElementById('saveNameIn').value = activeGame ? activeGame.name : "LisaWins";
        openModal('saveGameModal');
        setTimeout(()=>document.getElementById('saveNameIn').select(), 100);
    }

    function doSave(isNew) {
        let n = document.getElementById('saveNameIn').value || "LisaWins";
        let snap = { id: isNew ? Date.now() : (activeId || Date.now()), name: n, players: JSON.parse(JSON.stringify(players)), rounds: JSON.parse(JSON.stringify(rounds)), date: new Date().toLocaleString() };
        if(isNew || !activeId) library.push(snap); else {
            let idx = library.findIndex(x => x.id == activeId);
            if(idx !== -1) library[idx] = snap; else library.push(snap);
        }
        localStorage.setItem('v102_l', JSON.stringify(library)); activeId = snap.id; hasUnsavedChanges = false; closeModal('saveGameModal'); showToast("Saved!"); sync();
    }
    
    function openLibrary() {
        document.getElementById('libList').innerHTML = library.map((g, i) => `
            <div style="padding:12px; border-bottom:1px solid var(--border); display:flex; justify-content:space-between; align-items:center;">
                <div onclick="loadG(${i})" style="flex:1;"><b>${g.name}</b><br><small>${g.date}</small></div>
                <div style="display:flex; gap:10px;">
                    <button onclick="shareG(${i})" style="background:#27ae60; color:white; border:none; border-radius:6px; padding:8px 10px;">üì§</button>
                    <button onclick="delSave(${i})" style="background:#e74c3c; color:white; border:none; border-radius:6px; padding:8px 10px;">üóëÔ∏è</button>
                </div>
            </div>`).join('') || "No saved games.";
        openModal('libraryModal');
    }

    function loadG(i) {
        if (hasUnsavedChanges) {
            document.getElementById('confirmTitle').innerText = "Discard unsaved changes?";
            openModal('confirmModal');
            document.getElementById('confirmYes').onclick = () => { actuallyLoad(i); closeModal('confirmModal'); };
        } else { actuallyLoad(i); }
    }

    function actuallyLoad(i) {
        players = JSON.parse(JSON.stringify(library[i].players));
        rounds = JSON.parse(JSON.stringify(library[i].rounds));
        activeId = library[i].id;
        hasUnsavedChanges = false;
        closeModal('libraryModal');
        sync();
    }
    
    function delSave(i) { 
        document.getElementById('confirmTitle').innerText = "Delete Save?"; openModal('confirmModal'); 
        document.getElementById('confirmYes').onclick = () => { library.splice(i,1); localStorage.setItem('v102_l', JSON.stringify(library)); openLibrary(); closeModal('confirmModal'); }; 
    }

    function shareG(i) {
        let g = library[i], text = `üìä ${g.name}\nüèÜ STANDINGS:\n`;
        [...g.players].sort((a,b) => lowScoreWins ? a.score - b.score : b.score - a.score).forEach((p, idx) => text += `${idx+1}. ${p.name}: ${p.score}\n`);
        if (navigator.share) navigator.share({ text }).catch(() => copyToClipboard(text)); else copyToClipboard(text);
    }

    function copyToClipboard(t) { navigator.clipboard.writeText(t).then(() => showToast("Standings Copied!")); }

    function doReset(t) {
		if (hasUnsavedChanges) {
            document.getElementById('confirmTitle').innerText = "Discard unsaved changes?";
            openModal('confirmModal');
            document.getElementById('confirmYes').onclick = () => { actuallydoReset(t); closeModal('confirmModal'); };
        } else { actuallydoReset(t); }
	}

	function actuallydoReset(t) {
        if(t==='scores'){ rounds=[]; players.forEach(p=>p.score=0); } else { players=[]; rounds=[]; activeId=null; } 
        hasUnsavedChanges=true; closeModal('resetModal');
		sync(); 
    }
  

function updateVisibility() {
		const table = document.getElementById('leaderboard');
		const isChecked = document.getElementById('toggleNumbers').checked;
		if(isChecked)
		{

    table.classList.remove('hide-column');
  } else {
    table.classList.add('hide-column');
  }
		render();
        }
    
	
	
    render();
</script>
</body>
</html>
